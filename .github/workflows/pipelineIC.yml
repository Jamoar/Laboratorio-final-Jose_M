name: Workflow 
on:
  push:
    branches:
      - "feature-lab-final-Jose_m"

jobs:

  SAST: 
    runs-on: ubuntu-latest
    steps:



      - name: Setup Node.js 18
        uses: actions/setup-node@v2
        with:
          node-version: '18'



      - name: Clonacion de codigo
        uses: actions/checkout@v4



      - name: Setup Java 17
        uses: actions/setup-java@v3
        with:
          distribution: 'adopt'
          java-version: '17'



      - name: Validando existencia de proyecto en SonarCloud
        id: validateProjectOnSonar
        run: |
          set +e
          curl -f -X POST -u '${{ secrets.SONAR_TOKEN}}:' 'https://sonarcloud.io/api/projects/create' -d 'name=${{github.event.repository.name }}' -d 'project=${{github.event.repository.name }}'  -d 'organization=jamoar' -d 'visibility=public'
          if [ $? -ne 0 ]
          then
            echo "Proyecto ya existe en SonarCloud"
          Else
            echo "Proyecto ${{github.event.repository.name }} Fue creado existosamente en SonarCloud"
            echo "Se establece rama main como rama por defecto" 
            curl -X POST -u '${{ secrets.SONAR_TOKEN}}:' 'https://sonarcloud.io/api/project_branches/rename' -d 'name=main' -d 'project=${{github.event.repository.name }}' 
          fi


 